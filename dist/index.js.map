{"version":3,"file":"index.js","sources":["../src/index.js"],"sourcesContent":["import Vir from 'vir'\nimport $ from 'jquery'\n\nexport default function () {\n\n  return Vir({\n    data: {\n      index: -1,\n      keyword: '',\n      data: [],\n      show: false\n    },\n    watch: {\n      index(result) {\n        let {\n          old,\n          value\n        } = result\n\n        let $el = this.$$('li')\n\n        if (old > -1) {\n          $el.eq(old).removeClass('cur')\n        }\n        if (value > -1) {\n          $el.eq(value).addClass('cur')\n        }\n      },\n      keyword(result) {\n        let {\n          value\n        } = result\n        this.fetch((data) => {\n          this.set('data', data)\n        })\n      },\n      data(result) {\n        let {\n          value\n        } = result\n        this.render(value)\n        // render 后 需要清除之前的 dom 缓存 以及重置状态\n        this.$$('li', false)\n        this.set({\n          show: !!value.length,\n          index: -1\n        })\n      },\n      show(result) {\n        let $el = this.$$('.sugglist')\n        if (result.value) {\n          $el.show()\n        } else {\n          setTimeout(() => {\n            $el.hide()\n          }, 60)\n        }\n      }\n    },\n    events: {\n      'input propertychange->input': 'oninput',\n      'keydown->input': 'toggle enter',\n      'blur->input': 'onblur',\n      'click->input': 'onclick', // click 代替 focus\n      'mouseenter->.sugglist li': 'highlight',\n      'mouseleave->.sugglist': 'highlight',\n      'click->.sugglist li': 'toggle'\n    },\n    methods: {\n      highlight(event) {\n        if (event.type == 'mouseleave') {\n          this.set('index', -1)\n          return\n        }\n        let $el = $(event.currentTarget)\n        let index = $el.attr('data-index') || $el.index()\n        this.set('index', index)\n      },\n      index(n) {\n        let index = this.get('index') + n\n        let len = this.get('data').length\n        return -1 > index ? len - 1 : index < len ? index : -1\n      },\n      toggle(event) {\n        // click 切换\n        let data = this.get('data')\n        if (event.type == 'click') {\n          let $el = $(event.currentTarget)\n          let index = $el.attr('data-index') || $el.index()\n          let value = data[index]\n          this.set('flag', true)\n          this.$$('input').val(value)\n          this.submit()\n          return\n        }\n        // 上、下、tab键切换高亮\n        let code = event.which\n        if (!(code == 38 || code == 40 || code == 9)) {\n          return\n        }\n        event.preventDefault()\n        if (data.length == 0) {\n          return\n        }\n        let index = this.index(code == 38 ? -1 : 1)\n        let value = data[index]\n        if (index == -1) {\n          value = this.get('keyword')\n        }\n        this.set('index', index)\n        this.set('flag', true)\n        this.$$('input').val(value)\n      },\n      enter(event) {\n        let code = event.which\n        if (code == 13) { // 回车提交\n          this.submit()\n        }\n      },\n      oninput() {\n        // ie 非用户主动输入会触发 propertychange 事件\n        // 利用一个标记来判断\n        if (this.get('flag')) {\n          this.set('flag', false)\n          return\n        }\n        clearTimeout(this.get('timeout')) // throttle\n        this.set('timeout', setTimeout(() => {\n          this.set('keyword', this.$$('input').val())\n        }, 300))\n      },\n      onblur() {\n        this.set('show', false)\n      },\n      onclick(event) {\n        let keyword = this.get('keyword')\n        let val = this.$$('input').val()\n        let len = this.get('data').length\n        if (len && keyword == val) {\n          this.set('show', true)\n        } else {\n          // 重新 fetch\n          this.set('keyword', this.$$('input').val())\n        }\n      },\n      fetch(done) {},\n      render(data) {},\n      submit() {}\n    }\n  })\n}"],"names":["Vir","result","old","value","$el","$$","eq","removeClass","addClass","fetch","data","set","render","length","show","hide","event","type","$","currentTarget","index","attr","n","get","len","val","submit","code","which","preventDefault","setTimeout","keyword","done"],"mappings":"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"}